{% extends 'layout.html' %}

{% block title %}Buscador{% endblock %}

{% block content %}
    <h1>Recitals</h1>
        
    <!-- Search Form -->
    <form id="searchForm" method="POST" action="{{ url_for('search') }}">
        {{ form.hidden_tag() }}
        <input type="text" id="search" name="search" placeholder="Search recitals..." value="{{ search_term }}" onkeyup="checkSearchLength()">
        <button type="submit" id="searchButton">Search</button>
        <button type="button" id="resetButton" class="btn btn-secondary" onclick="resetSearch()">Reset</button>
    </form>

    <h1>Your Favorite Recitals</h1>
    <ul>
        {% for recital in favorites %}
        <li>{{ recital.artist }} at {{ recital.venue }} on {{ recital.date.strftime('%d/%m/%Y') }}
            <form action="{{ url_for('remove_favorite', recital_id=recital.id) }}" method="post" style="display:inline;">
                <button type="submit">Remove from Favorites</button>
            </form>
        </li>
        {% endfor %}
    </ul>

    <!-- Recital List -->
    <table>
        <thead>
            <tr>
                <th>Artist</th>
                <th>Date</th>
                <th>Venue</th>
                <th>Link</th>
                <th>Favorite</th>
            </tr>
        </thead>
        <tbody>
            {% for recital in recitals %}
            <tr>
                <td>{{ recital.artist }}</td>
                <td>{{ recital.date.strftime('%Y-%m-%d') }}</td>
                <td>{{ recital.venue }}</td>
                <td><a href="{{ recital.link }}">{{ recital.link }}</a></td>
                <td>
                    <form action="{{ url_for('add_favorite', recital_id=recital.id) }}" method="post" style="display:inline;">
                        <button type="submit">Add to Favorites</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Pagination -->
    <div>
        {% if page > 1 %}
        <a href="{{ url_for('recitals', page=page-1, per_page=per_page) }}">Previous</a>
        {% endif %}
        Page {{ page }} of {{ (total // per_page) + (1 if total % per_page else 0) }}
        {% if page * per_page < total %}
        <a href="{{ url_for('recitals', page=page+1, per_page=per_page) }}">Next</a>
        {% endif %}
    </div>
    <script>
        function checkSearchLength() {
            var searchInput = document.getElementById('search').value;
            var searchButton = document.getElementById('searchButton');
            if (searchInput.length >= 3) {
                searchButton.disabled = false;
            } else {
                searchButton.disabled = true;
            }
        }

        function resetSearch() {
            document.getElementById('search').value = '';
            checkSearchLength();
            document.getElementById('searchForm').submit();
        }

        // Initialize the button state on page load
        window.onload = function() {
            checkSearchLength();
            var searchInput = document.getElementById('search').value;
            var searchButton = document.getElementById('searchButton');
            if (searchInput.length >= 3 || searchInput.length > 0) {
                searchButton.disabled = false;
            } else {
                searchButton.disabled = true;
            }
        };
    </script>
{% endblock %}
